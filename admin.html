<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel</title>
<script type="module">
  // Firebase Setup
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
  import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCdX336VfLzIMZItn8eafwrPBlrBSKpxf0",
    authDomain: "flutter-ai-playground-51023.firebaseapp.com",
    projectId: "flutter-ai-playground-51023",
    storageBucket: "flutter-ai-playground-51023.firebasestorage.app",
    messagingSenderId: "589068038917",
    appId: "1:589068038917:web:b842384a52ec87c8213d6c"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Admin Login (Simple Key)
  const ADMIN_KEY = "YOUR_SECRET_KEY"; // change this to a strong key
  let loggedIn = false;

  window.loginAdmin = () => {
    const input = document.getElementById("adminKey").value;
    if(input === ADMIN_KEY){
      loggedIn = true;
      document.getElementById("loginSection").style.display="none";
      document.getElementById("panelSection").style.display="block";
    } else {
      alert("Incorrect admin key!");
    }
  }

  // Search user by code
  window.searchUser = async () => {
    const code = document.getElementById("userCode").value;
    if(!code) return alert("Enter a user code!");

    const userRef = doc(db, "users", code);
    const userSnap = await getDoc(userRef);

    if(userSnap.exists()){
      const data = userSnap.data();
      document.getElementById("userInfo").innerHTML = `
        <p><b>Name:</b> ${data.name || "N/A"}</p>
        <p><b>Email:</b> ${data.email || "N/A"}</p>
        <p><b>Current Balance:</b> KSH ${data.balance?.toLocaleString() || 0}</p>
      `;
      document.getElementById("addFundsSection").style.display="block";
      document.getElementById("addFundsBtn").dataset.userCode = code;
    } else {
      alert("User not found!");
      document.getElementById("userInfo").innerHTML = "";
      document.getElementById("addFundsSection").style.display="none";
    }
  }

  // Add funds to user
  window.addFunds = async () => {
    const amount = parseFloat(document.getElementById("fundAmount").value);
    if(!amount || amount <= 0) return alert("Enter valid amount!");

    const userCode = document.getElementById("addFundsBtn").dataset.userCode;
    const userRef = doc(db, "users", userCode);
    const userSnap = await getDoc(userRef);

    if(userSnap.exists()){
      const currentBalance = userSnap.data().balance || 0;
      await updateDoc(userRef, { balance: currentBalance + amount });
      alert(`KSH ${amount.toLocaleString()} added successfully!`);
      document.getElementById("fundAmount").value = "";
      searchUser(); // refresh info
    } else {
      alert("User not found!");
    }
  }
</script>
<style>
body{font-family:Arial,sans-serif;padding:20px;background:#f4f6f9;}
h1{color:#2a8cff;}
button{padding:10px 15px;border:none;border-radius:8px;background:#00d1c1;color:white;cursor:pointer;margin-top:10px;}
input{padding:10px;margin-top:5px;margin-bottom:10px;width:100%;border-radius:5px;border:1px solid #ccc;box-sizing:border-box;}
#panelSection{display:none;margin-top:20px;}
#addFundsSection{display:none;margin-top:15px;}
.user-info{background:white;padding:15px;border-radius:10px;box-shadow:0 3px 8px rgba(0,0,0,0.05);}
</style>
</head>
<body>

<h1>Admin Panel</h1>

<!-- Login Section -->
<div id="loginSection">
  <h3>Enter Admin Key</h3>
  <input type="password" id="adminKey" placeholder="Admin Key">
  <button onclick="loginAdmin()">Login</button>
</div>

<!-- Admin Panel Section -->
<div id="panelSection">
  <h3>Search User by Unique Code</h3>
  <input type="text" id="userCode" placeholder="Enter User Code">
  <button onclick="searchUser()">Search</button>

  <div class="user-info" id="userInfo"></div>

  <div id="addFundsSection">
    <h4>Add Funds</h4>
    <input type="number" id="fundAmount" placeholder="Amount to add">
    <button id="addFundsBtn" onclick="addFunds()">Add Funds</button>
  </div>
</div>

</body>
</html>
