<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>
<script type="module">
  // Firebase setup
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
  import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCdX336VfLzIMZItn8eafwrPBlrBSKpxf0",
    authDomain: "flutter-ai-playground-51023.firebaseapp.com",
    projectId: "flutter-ai-playground-51023",
    storageBucket: "flutter-ai-playground-51023.firebasestorage.app",
    messagingSenderId: "589068038917",
    appId: "1:589068038917:web:b842384a52ec87c8213d6c"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  window.addEventListener('DOMContentLoaded', () => {
    const searchBtn = document.getElementById('searchUserBtn');
    const updateBtn = document.getElementById('updateBalanceBtn');
    const codeInput = document.getElementById('userCode');
    const userFoundDiv = document.getElementById('userFound');
    const userNameSpan = document.getElementById('userName');
    const userBalanceInput = document.getElementById('userBalance');
    const noUserMsg = document.getElementById('noUserMsg');

    let currentUserDoc = null;

    searchBtn.addEventListener('click', async () => {
      const code = codeInput.value.trim();
      if (!code) return alert("Enter a user code.");

      const docRef = doc(db, "users", code);
      const docSnap = await getDoc(docRef);

      if (docSnap.exists()) {
        currentUserDoc = docRef;
        const data = docSnap.data();
        userNameSpan.innerText = data.name || "Unknown";
        userBalanceInput.value = data.balance || 0;
        userFoundDiv.style.display = "block";
        noUserMsg.style.display = "none";
      } else {
        userFoundDiv.style.display = "none";
        noUserMsg.style.display = "block";
      }
    });

    updateBtn.addEventListener('click', async () => {
      if (!currentUserDoc) return;

      const newBalance = parseFloat(userBalanceInput.value);
      if (isNaN(newBalance)) return alert("Enter a valid number.");

      await updateDoc(currentUserDoc, { balance: newBalance });
      alert("Balance updated successfully!");
    });
  });
</script>
<style>
  body{ font-family: Arial; padding:20px; background:#f5f5f5; }
  input, button{ padding:10px; margin:5px 0; border-radius:6px; }
  button{ cursor:pointer; }
  #userFound{ display:none; margin-top:20px; padding:15px; background:white; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.1);}
  #noUserMsg{ display:none; color:red; margin-top:10px; }
</style>
</head>
<body>

<h2>Admin Dashboard</h2>
<label>User Unique Code:</label><br>
<input type="text" id="userCode" placeholder="Enter code">
<button id="searchUserBtn">Search</button>

<div id="noUserMsg">No user found with this code.</div>

<div id="userFound">
  <p>Name: <span id="userName"></span></p>
  <label>Balance:</label><br>
  <input type="number" id="userBalance"><br>
  <button id="updateBalanceBtn">Update Balance</button>
</div>

</body>
</html>
